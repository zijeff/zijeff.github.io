<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>0xFunCTF2026wp</title>
    <link href="/2026/02/27/0xFunCTF2026wp/"/>
    <url>/2026/02/27/0xFunCTF2026wp/</url>
    
    <content type="html"><![CDATA[<h3 id="welcome">Welcome</h3><p>打开官方的discord服务器，稍加查看后即可得到flag。</p><img src="/2026/02/27/0xFunCTF2026wp/1.png" class=""><h3 id="leonine-misbegotten">Leonine Misbegotten</h3><p>理解题目意思后就很好做了，每轮操作对当前状态随机选取一种编码方式加密，从而得到下一状态的一部分，再对当前状态求<strong>sha1</strong> 作为下一状态的另一部分，拼接得到下一状态。</p><p><spanclass="math display"><em>s</em><sub><em>n</em> + 1</sub> = <em>f</em>(<em>s</em><sub><em>n</em></sub>) + <em>s</em><em>h</em><em>a</em>1(<em>s</em><sub><em>n</em></sub>)</span></p><p>因为 <strong>sha1</strong>得到的字节数为固定的，所以可以提取最后的20字节，遍历四种编码方式求解原码，再将其<strong>sha1</strong> 值进行比对校验，16次循环处理后即可得到结果。</p><p>具体代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b16decode, b32decode, b64decode, b85decode<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1<br><br><span class="hljs-comment"># 定义解码函数列表</span><br>DECODERS = [b16decode, b32decode, b64decode, b85decode]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>():<br>    <span class="hljs-comment"># 1. 读取 output 文件内容</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;output&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        current = f.read()<br><br>    rounds = <span class="hljs-number">16</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rounds):<br>        <span class="hljs-comment"># 2. 提取最后 20 字节的校验和</span><br>        checksum = current[-<span class="hljs-number">20</span>:]<br>        <span class="hljs-comment"># 3. 提取前面的编码数据</span><br>        payload = current[:-<span class="hljs-number">20</span>]<br>        <br>        found = <span class="hljs-literal">False</span><br>        <span class="hljs-comment"># 4. 尝试四种解码方式</span><br>        <span class="hljs-keyword">for</span> decode_func <span class="hljs-keyword">in</span> DECODERS:<br>            <span class="hljs-keyword">try</span>:<br>                decoded = decode_func(payload)<br>                <span class="hljs-comment"># 5. 校验 SHA1 是否匹配</span><br>                <span class="hljs-keyword">if</span> sha1(decoded).digest() == checksum:<br>                    current = decoded<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;第 <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span> 轮解密成功: 使用了 <span class="hljs-subst">&#123;decode_func.__name__&#125;</span>&quot;</span>)<br>                    found = <span class="hljs-literal">True</span><br>                    <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">except</span> Exception:<br>                <span class="hljs-comment"># 如果解码失败（比如字符不符合规范），尝试下一种</span><br>                <span class="hljs-keyword">continue</span><br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误：在第 <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span> 轮未能匹配到正确的解码方式。&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>    <br>    <span class="hljs-comment"># 输出结果</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n最终结果 (Flag):&quot;</span>)<br>    <span class="hljs-built_in">print</span>(current.decode(errors=<span class="hljs-string">&#x27;ignore&#x27;</span>))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solve()<br></code></pre></td></tr></table></figure><p>运行后得到结果：</p><img src="/2026/02/27/0xFunCTF2026wp/6.png" class=""><h3 id="the-slot-whisperer">The Slot Whisperer</h3><p>显然这是一个线性同余生成器相关的问题，生成过程如下：</p><p><spanclass="math display"><em>s</em><sub><em>n</em> + 1</sub> = <em>a</em><em>s</em><sub><em>n</em></sub> + <em>c</em> mod  <em>m</em></span></p><p>其中<spanclass="math inline"><em>a</em>, <em>c</em>, <em>m</em></span>我们全部已知，seed的值不知道，我们根据输出可以知道生成的前十个数字。进而我们知道：</p><p><spanclass="math display"><em>s</em><sub><em>i</em></sub> = <em>n</em><sub><em>i</em></sub> + 100<em>k</em>  <em>k</em> ∈ ℤ</span></p><p>又因为每次的state是模了m后的结果，所以必然小于m，因此我们可以爆破<spanclass="math inline"><em>k</em></span>的值从而恢复LCG的初始状态。</p><p>PS：因为<spanclass="math inline"><em>m</em> = 2147483647</span>，而循环步长为100，所以只需要2100万次左右的循环即可，这是很快的。</p><p>具体代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>():<br>    <span class="hljs-comment"># 题目给出的已知序列</span><br>    targets = [<span class="hljs-number">71</span>, <span class="hljs-number">6</span>, <span class="hljs-number">79</span>, <span class="hljs-number">39</span>, <span class="hljs-number">94</span>, <span class="hljs-number">28</span>, <span class="hljs-number">98</span>, <span class="hljs-number">72</span>, <span class="hljs-number">1</span>, <span class="hljs-number">76</span>]<br>    <br>    <span class="hljs-comment"># LCG 参数</span><br>    M = <span class="hljs-number">2147483647</span><br>    A = <span class="hljs-number">48271</span><br>    C = <span class="hljs-number">12345</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 正在爆破初始状态，正在验证完整序列: <span class="hljs-subst">&#123;targets&#125;</span>&quot;</span>)<br>    found_state = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(M // <span class="hljs-number">100</span> + <span class="hljs-number">2</span>):<br>        candidate = k * <span class="hljs-number">100</span> + targets[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> candidate &gt;= M:<br>            <span class="hljs-keyword">break</span><br>        temp_state = candidate<br>        is_valid = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(targets)):<br>            temp_state = (A * temp_state + C) % M<br>            <span class="hljs-keyword">if</span> temp_state % <span class="hljs-number">100</span> != targets[i]:<br>                is_valid = <span class="hljs-literal">False</span><br>                <span class="hljs-keyword">break</span><br>    <br>        <span class="hljs-keyword">if</span> is_valid:<br>            found_state = candidate<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 找到完美匹配的状态: <span class="hljs-subst">&#123;found_state&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>    <br>    <span class="hljs-keyword">if</span> found_state <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        current_state = found_state<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(targets) - <span class="hljs-number">1</span>):<br>             current_state = (A * current_state + C) % M<br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] 预测接下来的 5 个数字：&quot;</span>)<br>        predictions = []<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>            current_state = (A * current_state + C) % M<br>            output = current_state % <span class="hljs-number">100</span><br>            predictions.append(<span class="hljs-built_in">str</span>(output))<br>            <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span>.join(predictions))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] 未找到解，可能是输入序列有误。&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solve()<br></code></pre></td></tr></table></figure><p>运行截图如下：</p><img src="/2026/02/27/0xFunCTF2026wp/2.png" class=""><p>提交后得到flag：</p><img src="/2026/02/27/0xFunCTF2026wp/3.png" class=""><h3 id="meowl-ecc">MeOwl ECC</h3><p>正常的椭圆曲线加密，题目使用私钥<spanclass="math inline"><em>d</em></span>作为加密密钥，求解思路在于求出<spanclass="math inline"><em>d</em></span>的值。尝试对曲线的阶进行分解，发现无法分解，但是可以得到曲线的阶等于模数<spanclass="math inline"><em>p</em></span>，所以我们可以使用 <strong>Smart’sAttack</strong> 进行求解。</p><p>具体代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><br>p = <span class="hljs-number">1070960903638793793346073212977144745230649115077006408609822474051879875814028659881855169</span><br>A = <span class="hljs-number">0</span><br>B = <span class="hljs-number">19</span><br>E = EllipticCurve(GF(p),[A,B])<br><br>Px = <span class="hljs-number">850194424131363838588909772639181716366575918001556629491986206564277588835368712774900915</span><br>Py = <span class="hljs-number">749509706400667976882772182663506383952119723848300900481860146956631278026417920626334886</span><br><br>Qx = <span class="hljs-number">54250358642669756154015134950152636682437522715786363311759940981383592083045988845753867</span><br>Qy = <span class="hljs-number">324772290891069325219931358863917293864610371020855881775477694333357303867104131696431188</span><br><br>P = E(Px, Py)<br>Q = E(Qx, Qy)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">SmartAttack</span>(<span class="hljs-params">P,Q,p</span>):<br>    E = P.curve()<br>    Eqp = EllipticCurve(Qp(p, <span class="hljs-number">2</span>), [ ZZ(t) + randint(<span class="hljs-number">0</span>,p)*p <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> E.a_invariants() ])<br><br>    P_Qps = Eqp.lift_x(ZZ(P.xy()[<span class="hljs-number">0</span>]), <span class="hljs-built_in">all</span>=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">for</span> P_Qp <span class="hljs-keyword">in</span> P_Qps:<br>        <span class="hljs-keyword">if</span> GF(p)(P_Qp.xy()[<span class="hljs-number">1</span>]) == P.xy()[<span class="hljs-number">1</span>]:<br>            <span class="hljs-keyword">break</span><br><br>    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[<span class="hljs-number">0</span>]), <span class="hljs-built_in">all</span>=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">for</span> Q_Qp <span class="hljs-keyword">in</span> Q_Qps:<br>        <span class="hljs-keyword">if</span> GF(p)(Q_Qp.xy()[<span class="hljs-number">1</span>]) == Q.xy()[<span class="hljs-number">1</span>]:<br>            <span class="hljs-keyword">break</span><br><br>    p_times_P = p*P_Qp<br>    p_times_Q = p*Q_Qp<br><br>    x_P,y_P = p_times_P.xy()<br>    x_Q,y_Q = p_times_Q.xy()<br><br>    phi_P = -(x_P/y_P)<br>    phi_Q = -(x_Q/y_Q)<br>    k = phi_Q/phi_P<br>    <span class="hljs-keyword">return</span> ZZ(k)<br><br>d = SmartAttack(P, Q, p)<br><span class="hljs-built_in">print</span>(d)<br><br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES, DES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><br>d_found = d  <span class="hljs-comment"># &lt;--- 在这里填入上面算出的 d</span><br><br><span class="hljs-comment"># 题目密文参数</span><br>aes_iv_hex = <span class="hljs-string">&quot;7d0e47bb8d111b626f0e17be5a761a14&quot;</span><br>des_iv_hex = <span class="hljs-string">&quot;86fd0c44751700d4&quot;</span><br>ciphertext_hex = (<br>    <span class="hljs-string">&quot;7d34910bca6f505e638ed22f412dbf1b50d03243b739de0090d07fb097ec0a2c&quot;</span><br>    <span class="hljs-string">&quot;a19158949f32e39cd84adea33d2229556f635237088316d2&quot;</span><br>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>():<br>    <span class="hljs-keyword">if</span> d_found == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] 请先运行 SageMath 脚本算出 d，并填入 d_found 变量&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 1. 还原密钥</span><br>    k = long_to_bytes(d_found)<br>    aes_key = hashlib.sha256(k + <span class="hljs-string">b&quot;MeOwl::AES&quot;</span>).digest()[:<span class="hljs-number">16</span>]<br>    des_key = hashlib.sha256(k + <span class="hljs-string">b&quot;MeOwl::DES&quot;</span>).digest()[:<span class="hljs-number">8</span>]<br><br>    ciphertext = <span class="hljs-built_in">bytes</span>.fromhex(ciphertext_hex)<br>    aes_iv = <span class="hljs-built_in">bytes</span>.fromhex(aes_iv_hex)<br>    des_iv = <span class="hljs-built_in">bytes</span>.fromhex(des_iv_hex)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 2. 解密外层 (DES)</span><br>        <span class="hljs-comment"># DES 使用 pad(c1, 8)，解密后需 unpad 8</span><br>        des_cipher = DES.new(des_key, DES.MODE_CBC, iv=des_iv)<br>        c1_padded = des_cipher.decrypt(ciphertext)<br>        c1 = unpad(c1_padded, <span class="hljs-number">8</span>)<br><br>        <span class="hljs-comment"># 3. 解密内层 (AES)</span><br>        <span class="hljs-comment"># AES 使用 pad(flag, 16)，解密后需 unpad 16</span><br>        aes_cipher = AES.new(aes_key, AES.MODE_CBC, iv=aes_iv)<br>        flag_padded = aes_cipher.decrypt(c1)<br>        flag = unpad(flag_padded, <span class="hljs-number">16</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] Flag: <span class="hljs-subst">&#123;flag.decode()&#125;</span>&quot;</span>)<br>        <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[-] Decryption failed: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    decrypt()<br></code></pre></td></tr></table></figure><p>运行得到flag：<strong><em>0xfun{n0n_c4n0n1c4l_l1f7s_r_c00l}</em></strong></p><h3 id="bitstorm">BitStorm</h3><p>看似十分复杂的加密过程，仔细查看后发现都是在二进制域<strong>GF(2)</strong>上是线性的，所以只要输出够多就可以建立线性方程组求解。</p><p>具体代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># ==========================================</span><br><span class="hljs-comment"># 1. 符号化整数类 </span><br><span class="hljs-comment"># ==========================================</span><br><br>DIM = <span class="hljs-number">2048</span><br>F = GF(<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SymInt</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    模拟 64 位整数，使用 GF(2) 向量加法代替 XOR</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bits=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-keyword">if</span> bits <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-comment"># 默认为 0 (全零向量)</span><br>            <span class="hljs-variable language_">self</span>.bits = [vector(F, DIM) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>)]<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.bits = bits<br>            <span class="hljs-comment"># 截断或填充至 64 位</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.bits) &gt; <span class="hljs-number">64</span>:<br>                <span class="hljs-variable language_">self</span>.bits = <span class="hljs-variable language_">self</span>.bits[:<span class="hljs-number">64</span>]<br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.bits) &lt; <span class="hljs-number">64</span>:<br>                <span class="hljs-variable language_">self</span>.bits += [vector(F, DIM) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span> - <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.bits))]<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-comment"># 对应位向量相加 (GF2 加法即异或)</span><br>        new_bits = [a + b <span class="hljs-keyword">for</span> a, b <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(<span class="hljs-variable language_">self</span>.bits, other.bits)]<br>        <span class="hljs-keyword">return</span> SymInt(new_bits)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__lshift__</span>(<span class="hljs-params">self, n</span>):<br>        <span class="hljs-comment"># 左移 n: 低位补零向量，高位丢弃</span><br>        <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span><br>        <span class="hljs-keyword">if</span> n &gt;= <span class="hljs-number">64</span>: <span class="hljs-keyword">return</span> SymInt()<br>        zero_vec = vector(F, DIM)<br>        new_bits = [zero_vec] * n + <span class="hljs-variable language_">self</span>.bits[:-n]<br>        <span class="hljs-keyword">return</span> SymInt(new_bits)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__rshift__</span>(<span class="hljs-params">self, n</span>):<br>        <span class="hljs-comment"># 右移 n: 高位补零向量，低位丢弃</span><br>        <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span><br>        <span class="hljs-keyword">if</span> n &gt;= <span class="hljs-number">64</span>: <span class="hljs-keyword">return</span> SymInt()<br>        zero_vec = vector(F, DIM)<br>        new_bits = <span class="hljs-variable language_">self</span>.bits[n:] + [zero_vec] * n<br>        <span class="hljs-keyword">return</span> SymInt(new_bits)<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rotate_left</span>(<span class="hljs-params">self, n</span>):<br>        <span class="hljs-comment"># 循环左移: (x &lt;&lt; n) | (x &gt;&gt; (64-n))</span><br>        n = n % <span class="hljs-number">64</span><br>        <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span><br>        new_bits = [<span class="hljs-variable language_">self</span>.bits[(i - n) % <span class="hljs-number">64</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>)]<br>        <span class="hljs-keyword">return</span> SymInt(new_bits)<br><br><span class="hljs-comment"># ==========================================</span><br><span class="hljs-comment"># 2. 模拟 RNG 逻辑 (使用 + 代替 ^)</span><br><span class="hljs-comment"># ==========================================</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SymbolicGiantLinearRNG</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.state_size = <span class="hljs-number">32</span><br>        <span class="hljs-variable language_">self</span>.state = []<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.state_size):<br>            shift = <span class="hljs-number">64</span> * (<span class="hljs-variable language_">self</span>.state_size - <span class="hljs-number">1</span> - i)<br>            bits = []<br>            <span class="hljs-keyword">for</span> bit_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>                <span class="hljs-comment"># bit_idx 0 is LSB of this chunk</span><br>                <span class="hljs-comment"># 对应 seed 的绝对位位置</span><br>                seed_bit_index = shift + bit_idx<br>                <br>                <span class="hljs-comment"># 创建基向量</span><br>                v = vector(F, DIM)<br>                <span class="hljs-keyword">if</span> seed_bit_index &lt; DIM:<br>                    v[seed_bit_index] = <span class="hljs-number">1</span><br>                bits.append(v)<br>            <span class="hljs-variable language_">self</span>.state.append(SymInt(bits))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">next</span>(<span class="hljs-params">self</span>):<br>        s = <span class="hljs-variable language_">self</span>.state<br>        taps = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">13</span>, <span class="hljs-number">22</span>, <span class="hljs-number">28</span>, <span class="hljs-number">31</span>]<br>        <br>        new_val = SymInt() <span class="hljs-comment"># 0</span><br>        <br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> taps:<br>            val = s[i]<br>            mixed = val + (val &lt;&lt; <span class="hljs-number">11</span>) + (val &gt;&gt; <span class="hljs-number">7</span>)<br>            <br>            rot = (i * <span class="hljs-number">3</span>) % <span class="hljs-number">64</span><br>            mixed = mixed.rotate_left(rot)<br>            <br>            new_val = new_val + mixed<br> <br>        <span class="hljs-comment"># new_val ^= (s[-1] &gt;&gt; 13) ^ ((s[-1] &lt;&lt; 5) &amp; mask)</span><br>        new_val = new_val + (s[-<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">13</span>) + (s[-<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">5</span>)<br>        <br>        <span class="hljs-comment"># 更新状态</span><br>        <span class="hljs-variable language_">self</span>.state = s[<span class="hljs-number">1</span>:] + [new_val]<br>        <br>        <span class="hljs-comment"># 计算输出</span><br>        out = SymInt()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.state_size):<br>            <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>                out = out + <span class="hljs-variable language_">self</span>.state[i]<br>            <span class="hljs-keyword">else</span>:<br>                val = <span class="hljs-variable language_">self</span>.state[i]<br>                <span class="hljs-comment"># out ^= ((val &gt;&gt; 2) | (val &lt;&lt; 62)) -&gt; Rotate Left 62</span><br>                out = out + val.rotate_left(<span class="hljs-number">62</span>)<br>                <br>        <span class="hljs-keyword">return</span> out<br><br><span class="hljs-comment"># ==========================================</span><br><span class="hljs-comment"># 3. 主求解函数</span><br><span class="hljs-comment"># ==========================================</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>():<br>    real_outputs = [<br>        <span class="hljs-number">11329270341625800450</span>, <span class="hljs-number">14683377949987450496</span>, <span class="hljs-number">11656037499566818711</span>, <span class="hljs-number">14613944493490807838</span>, <br>        <span class="hljs-number">370532313626579329</span>, <span class="hljs-number">5006729399082841610</span>, <span class="hljs-number">8072429272270319226</span>, <span class="hljs-number">3035866339305997883</span>, <br>        <span class="hljs-number">8753420467487863273</span>, <span class="hljs-number">15606411394407853524</span>, <span class="hljs-number">5092825474622599933</span>, <span class="hljs-number">6483262783952989294</span>, <br>        <span class="hljs-number">15380511644426948242</span>, <span class="hljs-number">13769333495965053018</span>, <span class="hljs-number">5620127072433438895</span>, <span class="hljs-number">6809804883045878003</span>, <br>        <span class="hljs-number">1965081297255415258</span>, <span class="hljs-number">2519823891124920624</span>, <span class="hljs-number">8990634037671460127</span>, <span class="hljs-number">3616252826436676639</span>, <br>        <span class="hljs-number">1455424466699459058</span>, <span class="hljs-number">2836976688807481485</span>, <span class="hljs-number">11291016575083277338</span>, <span class="hljs-number">1603466311071935653</span>, <br>        <span class="hljs-number">14629944881049387748</span>, <span class="hljs-number">3844587940332157570</span>, <span class="hljs-number">584252637567556589</span>, <span class="hljs-number">10739738025866331065</span>, <br>        <span class="hljs-number">11650614949586184265</span>, <span class="hljs-number">1828791347803497022</span>, <span class="hljs-number">9101164617572571488</span>, <span class="hljs-number">16034652114565169975</span>, <br>        <span class="hljs-number">13629596693592688618</span>, <span class="hljs-number">17837636002790364294</span>, <span class="hljs-number">10619900844581377650</span>, <span class="hljs-number">15079130325914713229</span>, <br>        <span class="hljs-number">5515526762186744782</span>, <span class="hljs-number">1211604266555550739</span>, <span class="hljs-number">11543408140362566331</span>, <span class="hljs-number">18425294270126030355</span>, <br>        <span class="hljs-number">2629175584127737886</span>, <span class="hljs-number">6074824578506719227</span>, <span class="hljs-number">6900475985494339491</span>, <span class="hljs-number">3263181255912585281</span>, <br>        <span class="hljs-number">12421969688110544830</span>, <span class="hljs-number">10785482337735433711</span>, <span class="hljs-number">10286647144557317983</span>, <span class="hljs-number">15284226677373655118</span>, <br>        <span class="hljs-number">9365502412429803694</span>, <span class="hljs-number">4248763523766770934</span>, <span class="hljs-number">13642948918986007294</span>, <span class="hljs-number">3512868807899248227</span>, <br>        <span class="hljs-number">14810275182048896102</span>, <span class="hljs-number">1674341743043240380</span>, <span class="hljs-number">28462467602860499</span>, <span class="hljs-number">1060872896572731679</span>, <br>        <span class="hljs-number">13208674648176077254</span>, <span class="hljs-number">14702937631401007104</span>, <span class="hljs-number">5386638277617718038</span>, <span class="hljs-number">8935128661284199759</span><br>    ]<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Initializing Symbolic RNG...&quot;</span>)<br>    rng = SymbolicGiantLinearRNG()<br>    <br>    matrix_rows = []<br>    target_vector = []<br>    <br>    <span class="hljs-comment"># 取 40 个输出 (40 * 64 &gt; 2048) 确保满秩</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Collecting equations...&quot;</span>)<br>    <span class="hljs-keyword">for</span> k, real_val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(real_outputs[:<span class="hljs-number">40</span>]):<br>        sym_val = rng.<span class="hljs-built_in">next</span>()<br>        <br>        <span class="hljs-keyword">for</span> bit_i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>            <span class="hljs-comment"># 获取符号化系数 (向量)</span><br>            coeffs = sym_val.bits[bit_i]<br>            <br>            <span class="hljs-comment"># 获取真实值比特</span><br>            target_bit = (real_val &gt;&gt; bit_i) &amp; <span class="hljs-number">1</span><br>            <br>            matrix_rows.append(coeffs)<br>            target_vector.append(target_bit)<br>            <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] Constructing Matrix (<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(matrix_rows)&#125;</span> x <span class="hljs-subst">&#123;DIM&#125;</span>)...&quot;</span>)<br>    <br>    M = Matrix(F, matrix_rows)<br>    b = vector(F, target_vector)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Solving linear system...&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        solution = M.solve_right(b)<br>    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Solver failed.&quot;</span>)<br>        <span class="hljs-built_in">print</span>(e)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Reconstructing Flag...&quot;</span>)<br>    <br>    seed_int = <span class="hljs-number">0</span><br>    <span class="hljs-comment"># solution 向量的索引 i 直接对应 seed_int 的第 i 位</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(DIM):<br>        <span class="hljs-keyword">if</span> solution[i] == <span class="hljs-number">1</span>:<br>            seed_int |= (<span class="hljs-number">1</span> &lt;&lt; i)<br>            <br>    <span class="hljs-keyword">try</span>:<br>        flag_bytes = <span class="hljs-built_in">int</span>(seed_int).to_bytes(<span class="hljs-number">256</span>, <span class="hljs-string">&#x27;big&#x27;</span>)<br>        flag = flag_bytes.replace(<span class="hljs-string">b&#x27;\x00&#x27;</span>, <span class="hljs-string">b&#x27;&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;FLAG:&quot;</span>, <span class="hljs-string">&quot;0xfun&#123;&quot;</span> + flag.decode(errors=<span class="hljs-string">&#x27;ignore&#x27;</span>) + <span class="hljs-string">&quot;&#125;&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span> + <span class="hljs-string">&quot;\n&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[-] Decoding error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solve()<br></code></pre></td></tr></table></figure><p>运行得到结果：</p><img src="/2026/02/27/0xFunCTF2026wp/4.png" class=""><h3 id="the-roulette-conspiracy">The Roulette Conspiracy</h3><p>很正常的 MT19937 随机数生成的问题，链接容器后发现没有限制 spin的次数，所以我们可以获取连续的624个输出从而恢复随机数生成器的初始状态，进而预测接下来的10个输出。</p><p>唯一值得注意的就是脚本的数据上传格式（），具体代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># --- 1. MT19937 逆向核心函数 ---</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_right_shift</span>(<span class="hljs-params">val, shift</span>):<br>    res = val<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span> // shift):<br>        res = val ^ (res &gt;&gt; shift)<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_left_shift</span>(<span class="hljs-params">val, shift, mask</span>):<br>    res = val<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span> // shift):<br>        res = val ^ ((res &lt;&lt; shift) &amp; mask)<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">untemper</span>(<span class="hljs-params">v</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;撤销 MT19937 的 Tempering 过程，还原内部状态数组的值&quot;&quot;&quot;</span><br>    v = inverse_right_shift(v, <span class="hljs-number">18</span>)<br>    v = inverse_left_shift(v, <span class="hljs-number">15</span>, <span class="hljs-number">0xefc60000</span>)<br>    v = inverse_left_shift(v, <span class="hljs-number">7</span>, <span class="hljs-number">0x9d2c5680</span>)<br>    v = inverse_right_shift(v, <span class="hljs-number">11</span>)<br>    <span class="hljs-keyword">return</span> v<br><br><span class="hljs-comment"># --- 2. 网络交互配置 ---</span><br>HOST = <span class="hljs-string">&#x27;chall.0xfun.org&#x27;</span> <br>PORT = <span class="hljs-number">43843</span><br><br>io = remote(HOST, PORT)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_next_raw</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;发送 spin 指令并获取还原 XOR 后的原始随机数&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 匹配提示符 &quot;&gt; &quot; (注意可能有空格)</span><br>    io.sendlineafter(<span class="hljs-string">b&quot;&gt;&quot;</span>, <span class="hljs-string">b&quot;spin&quot;</span>)<br>    <span class="hljs-comment"># 接收返回的一行数字</span><br>    line = io.recvline().decode().strip()<br>    <span class="hljs-comment"># 兼容性处理：如果读到的是空行，再读一行</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> line <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> line.isdigit():<br>        line = io.recvline().decode().strip()<br>    <br>    obfuscated = <span class="hljs-built_in">int</span>(line)<br>    <span class="hljs-comment"># 题目逻辑：obfuscated = raw ^ 0xCAFEBABE</span><br>    raw = obfuscated ^ <span class="hljs-number">0xCAFEBABE</span><br>    <span class="hljs-keyword">return</span> raw<br><br><span class="hljs-comment"># --- 3. 收集 624 个状态以克隆生成器 ---</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] 正在从服务器收集 624 个数据点...&quot;</span>)<br>state_elements = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">624</span>):<br>    raw_val = get_next_raw()<br>    state_elements.append(untemper(raw_val))<br>    <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span>) % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;已收集: <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>/624&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] 状态还原成功！&quot;</span>)<br><br><span class="hljs-comment"># --- 4. 同步本地生成器 ---</span><br><span class="hljs-comment"># 设置 index 为 624，确保下一次 getrandbits 会触发 twist() 生成下一组序列</span><br>predictor = random.Random()<br>predictor.setstate((<span class="hljs-number">3</span>, <span class="hljs-built_in">tuple</span>(state_elements + [<span class="hljs-number">624</span>]), <span class="hljs-literal">None</span>))<br><br><span class="hljs-comment"># --- 5. 提交预测 (一行提交) ---</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] 正在准备预测结果...&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;&gt;&quot;</span>, <span class="hljs-string">b&quot;predict&quot;</span>)<br><br><span class="hljs-comment"># 生成接下来 10 个原始值 (raw bits)</span><br>predictions = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    val = predictor.getrandbits(<span class="hljs-number">32</span>)<br>    predictions.append(<span class="hljs-built_in">str</span>(val))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;预测值 <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>:2d&#125;</span>: <span class="hljs-subst">&#123;val&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># 将 10 个数字用空格连接成一行发送</span><br>payload = <span class="hljs-string">&quot; &quot;</span>.join(predictions)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 发送 Payload: <span class="hljs-subst">&#123;payload&#125;</span>&quot;</span>)<br>io.sendline(payload.encode())<br><br><span class="hljs-comment"># --- 6. 获取 Flag ---</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[!] 等待服务器响应 Flag...&quot;</span>)<br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># 使用 interactive() 方便在拿到 Flag 后手动操作，或直接 recvall</span><br>    <span class="hljs-comment"># io.interactive() </span><br>    <span class="hljs-built_in">print</span>(io.recvall(timeout=<span class="hljs-number">5</span>).decode())<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[!] 读取结束或连接已关闭。&quot;</span>)<br><br>io.close()<br></code></pre></td></tr></table></figure><p>运行后得到结果：</p><img src="/2026/02/27/0xFunCTF2026wp/5.png" class=""><h3 id="hawk_ii">Hawk_II</h3><p>打开一看快吓死我了，代码量是真的大。但仔细观察后我们发现，题目好像直接在输出中打印了私钥。这下爽了，直接一个简单脚本带走。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><br><span class="hljs-comment"># ==========================================</span><br><span class="hljs-comment"># 1. 填入题目输出的 IV 和 ENC</span><br><span class="hljs-comment"># ==========================================</span><br>iv_hex = <span class="hljs-string">&quot;ac518ee77848d87912548668d3240aa4&quot;</span>  <br>enc_hex = <span class="hljs-string">&quot;ab425b6c2c0a6760a5e9c52ba25dfc47da97afeeceb9823e553dcccc971b0f25c876ea63ed867d77e3295082064a3f69&quot;</span> <br><br><span class="hljs-comment"># ==========================================</span><br><span class="hljs-comment"># 2. 填入题目输出的 sk 字符串</span><br><span class="hljs-comment"># ==========================================</span><br><br>sk_str = <span class="hljs-string">&quot;&quot;&quot;(z^255 + z^254 + 4*z^253 - z^252 - z^251 + 2*z^250 + 3*z^249 + 3*z^246 + z^244 + z^243 - 3*z^242 - 2*z^240 - z^238 - z^237 + 2*z^236 + 2*z^235 - z^234 + 2*z^233 + 3*z^232 - 2*z^231 - z^230 + 2*z^229 - z^228 - 3*z^227 + z^226 - z^224 + 3*z^223 + z^222 + z^221 - 2*z^220 + z^219 - 3*z^218 + 2*z^217 - z^216 + 3*z^215 + 6*z^214 + z^213 - 2*z^212 - 2*z^211 - 3*z^210 - 2*z^209 - z^208 - 3*z^207 - z^206 + z^205 + z^204 + 3*z^203 - z^202 + 3*z^201 + z^200 - 2*z^199 - 5*z^198 - 2*z^197 - 2*z^196 - 2*z^195 + 3*z^194 + 6*z^193 - 2*z^192 + z^191 - 2*z^190 - z^189 + z^187 + 2*z^186 - 3*z^185 - 5*z^184 + 5*z^182 - z^181 + 2*z^180 - 4*z^179 + 3*z^178 - z^177 + z^175 - 4*z^173 - 2*z^171 + z^169 + 2*z^168 + z^167 - z^166 + 4*z^165 - 3*z^164 - 3*z^163 - 3*z^162 + z^161 - 3*z^160 - 3*z^159 + 2*z^158 - 2*z^156 - 2*z^155 + 3*z^154 - z^153 - 2*z^152 - z^151 - 2*z^150 - z^149 + z^148 + z^147 - 4*z^146 - 2*z^145 + 3*z^144 + 4*z^143 - z^142 - 2*z^141 + 2*z^139 - 2*z^138 - 3*z^136 + z^135 + z^134 + 3*z^133 - z^132 + z^131 - 4*z^130 - 2*z^129 - z^128 + z^127 - z^126 - 3*z^125 + z^124 + 2*z^123 + 3*z^122 - 4*z^120 + 6*z^119 - 3*z^118 + z^117 + z^116 + 4*z^115 + 2*z^114 - z^113 + 2*z^112 - z^111 - z^110 - 4*z^109 - 3*z^107 + z^106 + 3*z^105 + 2*z^103 - z^102 + z^101 - z^100 + z^98 + z^95 - 3*z^94 + z^93 - 2*z^92 + z^91 - 5*z^90 + 3*z^89 - z^88 - z^87 - 4*z^86 + z^85 - z^84 + 2*z^82 - 2*z^81 + z^78 + z^75 + 5*z^74 + z^73 + z^71 - 3*z^70 - z^68 + 2*z^67 - z^66 + z^65 - 2*z^64 + 2*z^63 + z^62 - 3*z^61 - 2*z^60 - 3*z^58 + 2*z^57 + z^56 - 2*z^55 + z^54 + z^53 + 4*z^52 - z^51 + z^50 - z^49 + z^48 + z^47 - z^46 + 2*z^45 - z^43 - z^42 + z^41 - z^40 - 7*z^39 + 3*z^38 + 3*z^37 + z^36 - z^35 + 2*z^34 + 2*z^31 + 2*z^29 - 3*z^28 - z^26 + z^25 - z^24 + 2*z^23 - 3*z^22 - z^21 + z^20 - 2*z^18 + z^17 + z^15 - z^14 + 2*z^12 - 2*z^11 - z^10 + 2*z^9 + z^8 - z^7 + z^6 - 3*z^5 - z^4 + 3*z^3 - 5*z^2 - z, 2*z^255 - z^254 + z^253 + z^252 - 4*z^250 + 2*z^249 - z^248 + z^246 + z^244 + 2*z^242 - z^241 + 2*z^239 + 2*z^238 - 2*z^237 - 3*z^236 + z^235 - 2*z^234 + z^233 + 3*z^231 + z^230 + z^229 + 3*z^228 - 2*z^227 - z^226 - z^224 - z^223 + 4*z^222 - 3*z^220 - z^219 + 2*z^218 - z^217 - 2*z^216 + 3*z^215 + 2*z^214 - 2*z^213 + z^210 + z^209 + 5*z^207 + z^206 - z^205 - z^202 - 2*z^200 - 2*z^199 + z^198 + z^197 - z^196 + 3*z^195 + 4*z^194 - 2*z^193 + 3*z^191 - z^189 + 5*z^188 - 5*z^187 + z^185 + 3*z^184 - 4*z^183 + 3*z^182 - z^181 - z^180 + 4*z^179 + 3*z^178 - 3*z^176 + z^175 - z^174 + z^173 - 3*z^171 + z^169 - z^168 - 3*z^167 - z^165 + z^164 + 2*z^162 - z^161 - 2*z^160 + z^158 + 2*z^156 + z^155 + 2*z^154 - z^153 + 4*z^152 - 4*z^151 - 3*z^150 + 4*z^149 - 2*z^147 + z^146 - z^145 - z^144 + z^143 + z^142 - 2*z^140 + 2*z^139 + 2*z^138 + 3*z^137 - 2*z^136 + z^135 - 3*z^134 - 3*z^133 - z^132 + z^131 + 2*z^130 - z^129 + 4*z^128 - z^127 - z^126 + z^125 - 3*z^124 - z^123 + z^122 + z^121 - 3*z^120 + z^119 + z^118 + 3*z^117 - 2*z^116 - z^115 + z^114 + 2*z^113 + 4*z^112 + 2*z^111 - 2*z^110 + z^109 - 2*z^108 + z^107 - 2*z^105 + 4*z^103 - z^101 - 2*z^100 + 6*z^98 + 3*z^97 - z^94 - 2*z^92 - z^91 - 3*z^90 + z^89 + z^88 + 2*z^87 + z^86 - z^85 + 2*z^84 + 2*z^83 - z^82 - 3*z^81 + 3*z^80 - 2*z^79 - 2*z^78 + 2*z^77 + 3*z^76 + z^75 + z^70 - z^69 - z^68 + 2*z^67 - 2*z^66 - z^65 - 3*z^64 - z^63 - 2*z^62 + z^61 + 2*z^60 + 3*z^59 + z^58 + z^57 - 5*z^56 + 2*z^55 + 3*z^54 + z^53 + 4*z^52 + z^51 - z^50 - z^49 + z^48 - 3*z^47 - z^46 + 2*z^44 - z^42 - 3*z^41 + 3*z^38 + z^37 - 2*z^35 - 2*z^34 - z^33 + z^32 + 4*z^31 + 2*z^30 - 2*z^29 - 2*z^27 + z^25 - z^24 - 3*z^23 + 2*z^21 + 2*z^17 - z^16 - 3*z^15 + 2*z^14 + z^12 + 2*z^11 + 2*z^10 + 3*z^9 + 4*z^8 - 2*z^6 - z^5 + 3*z^4 + z^2 + z - 2, 13*z^255 - 17*z^254 - 3*z^253 - 8*z^252 + 7*z^251 - 15*z^250 + 21*z^249 + 11*z^248 - 7*z^247 + 22*z^246 + 3*z^245 - 10*z^244 - 8*z^243 - 12*z^242 + 5*z^241 + 8*z^240 + 4*z^239 - 6*z^238 + 16*z^237 - 2*z^236 + 21*z^235 - z^234 - 14*z^233 - z^232 + 11*z^231 - 5*z^230 + 3*z^229 + 12*z^228 + 11*z^227 + 5*z^226 + 2*z^225 + 18*z^224 - 13*z^222 + 14*z^221 + 6*z^220 - 3*z^219 + 13*z^218 + 2*z^217 - 11*z^216 - 3*z^215 + 8*z^214 + z^213 - 3*z^212 - 11*z^211 - 4*z^210 + 2*z^209 - 16*z^208 + 11*z^207 + 5*z^206 - 12*z^205 + 17*z^204 + 15*z^203 - 5*z^201 - 19*z^200 - 8*z^199 - 11*z^198 + 13*z^197 - 18*z^196 + 18*z^195 - 6*z^194 + z^193 + 6*z^192 - 11*z^191 + 2*z^190 + 7*z^189 - 4*z^188 + 2*z^187 - z^186 + 5*z^185 - 13*z^184 - 6*z^183 - 4*z^182 + 19*z^181 - 4*z^180 + 20*z^179 - 11*z^178 + 5*z^177 - 5*z^176 - z^175 + z^174 + 2*z^172 + 4*z^171 + 3*z^170 + 3*z^169 - 7*z^168 - 9*z^167 - 14*z^166 + 13*z^165 + 2*z^164 - 4*z^163 - 3*z^162 + 7*z^161 + 17*z^160 + 8*z^159 + 6*z^158 - 16*z^157 + 11*z^156 + 17*z^155 + 2*z^154 - 4*z^153 - 5*z^152 + 5*z^151 - 4*z^150 - 2*z^149 + 3*z^148 - 3*z^147 - 7*z^146 + 12*z^145 + 5*z^144 + 5*z^143 - 11*z^142 - 5*z^141 - 9*z^140 - 3*z^139 + 11*z^137 - 7*z^136 + 14*z^135 + 5*z^134 + 12*z^133 - z^132 - z^131 - 14*z^130 - 3*z^129 - 8*z^128 + 7*z^127 + 11*z^126 + 12*z^125 - 2*z^124 + 6*z^123 - 6*z^122 - 2*z^121 - 20*z^120 - 6*z^119 + 2*z^118 + 11*z^117 - 4*z^116 - 9*z^115 - 5*z^114 + 3*z^113 + 5*z^112 + 4*z^111 + 6*z^109 - 8*z^108 + 12*z^107 - z^106 + 6*z^105 + z^104 - 11*z^103 - 9*z^102 - 5*z^101 + 4*z^100 + 5*z^99 + z^98 - 6*z^97 - 9*z^96 + 6*z^95 + 3*z^94 + 10*z^93 - 5*z^92 - 12*z^91 + 4*z^90 - 10*z^89 + 9*z^88 + z^87 + 3*z^86 + z^85 + 17*z^84 + 4*z^83 - 25*z^82 - 4*z^81 - 3*z^80 + 23*z^79 - 6*z^78 - 4*z^77 - 5*z^76 + 7*z^75 + 2*z^74 + 7*z^73 + z^71 - 12*z^70 + 6*z^69 + 7*z^68 - 9*z^67 - 16*z^66 + 16*z^65 - 10*z^64 + 11*z^63 - 6*z^62 + 5*z^61 - 8*z^60 - 3*z^58 + z^57 - 5*z^56 + 11*z^54 - 4*z^53 + 4*z^52 + 7*z^51 - 17*z^50 - 11*z^49 + 14*z^48 + 4*z^47 + 8*z^46 - 7*z^45 - 5*z^44 + 5*z^43 + 9*z^42 - 2*z^41 + 6*z^40 - 9*z^39 - 23*z^38 - 7*z^37 - 10*z^36 + 10*z^35 - z^34 + z^33 - z^32 + 12*z^31 + 9*z^30 - 5*z^29 - z^28 - 18*z^27 + 2*z^26 - 2*z^25 - 6*z^24 + 11*z^23 - 5*z^22 + 5*z^21 + 4*z^20 + 3*z^19 - 2*z^18 - 5*z^17 - 8*z^16 + 8*z^15 + 14*z^14 + 5*z^12 - 12*z^11 - 27*z^10 + 20*z^9 + 10*z^8 - 12*z^7 - 3*z^6 + 8*z^5 - 7*z^4 + 12*z^3 + 4*z^2 - 20*z - 10, -z^255 + 5*z^254 - 4*z^253 - 5*z^252 + 4*z^251 + 3*z^249 - 13*z^248 - 16*z^247 - 7*z^246 + 3*z^245 + 2*z^244 + 3*z^243 + 10*z^242 + 7*z^241 - 15*z^240 - 11*z^239 - 7*z^238 - 5*z^237 + 3*z^236 + 10*z^235 + 3*z^234 - 16*z^233 + 3*z^232 - 13*z^230 + 10*z^229 + 9*z^228 + 14*z^227 - 4*z^226 + 9*z^225 - 18*z^224 - 23*z^223 + 4*z^222 - z^221 + 3*z^219 + 17*z^218 - 9*z^217 + 2*z^216 + 10*z^215 - 17*z^214 - 14*z^213 + 15*z^212 + 21*z^211 - 10*z^210 + 22*z^209 - 29*z^207 - 19*z^206 + 6*z^205 + 5*z^204 - 12*z^203 + 15*z^202 + 12*z^201 - 3*z^200 - 6*z^199 + 14*z^198 - 6*z^197 - 4*z^196 + 11*z^195 - 9*z^194 - z^193 - 7*z^191 - 2*z^190 - 2*z^189 - 3*z^187 - 8*z^186 + 2*z^185 + 5*z^184 + 4*z^183 + 3*z^182 - 10*z^180 - 14*z^179 + 6*z^178 - 3*z^177 - 8*z^176 + 12*z^175 + 11*z^174 + z^173 - 2*z^172 - 13*z^171 - 24*z^170 + 2*z^168 - 11*z^167 + 6*z^166 + 7*z^165 + 8*z^164 - 8*z^163 + 5*z^162 - 9*z^161 + 4*z^160 + 7*z^159 + 9*z^158 - 2*z^157 - 7*z^156 + z^155 - 18*z^154 - 3*z^153 - 5*z^152 + 19*z^151 - z^150 - 3*z^149 - 2*z^148 - 13*z^147 + 3*z^146 - z^145 + 4*z^144 - 7*z^143 + 5*z^142 + z^141 - 3*z^140 - z^139 - z^138 - 16*z^137 - 13*z^136 + 10*z^135 + 14*z^134 + z^133 + 18*z^132 - 18*z^131 - 3*z^130 - 4*z^129 + 9*z^128 - 13*z^127 - z^126 + 4*z^125 + 3*z^124 + z^123 - 10*z^122 + 6*z^121 + 8*z^120 + 6*z^119 + 7*z^118 + 11*z^117 - 9*z^116 + 7*z^115 + 14*z^114 - 13*z^113 - 8*z^112 + 12*z^111 + 4*z^110 + 5*z^109 + 10*z^108 - 15*z^107 - 14*z^106 + 10*z^105 + 2*z^104 - z^103 - 13*z^102 + 12*z^101 + 7*z^100 + 4*z^99 - z^97 - 8*z^96 - 7*z^95 + 5*z^94 + 4*z^93 + 3*z^92 - 10*z^91 - 2*z^90 + 4*z^89 + 18*z^88 + 6*z^87 + 7*z^86 + 4*z^84 - 5*z^83 - 3*z^82 + 7*z^81 - 17*z^80 - 10*z^79 + 2*z^78 - 7*z^77 - 6*z^76 + 2*z^75 + z^74 - 15*z^73 + 14*z^72 + 14*z^71 - 6*z^70 + 16*z^69 + 6*z^68 + 2*z^67 - 4*z^66 + 5*z^65 - 10*z^64 + z^63 - 5*z^62 + 4*z^61 + z^60 - 5*z^59 + 5*z^58 + 8*z^57 - 2*z^56 - z^55 + 16*z^54 - 4*z^53 - 9*z^52 - 10*z^50 + 14*z^48 + z^47 - 21*z^46 - 6*z^45 + 15*z^44 + 9*z^43 + 4*z^42 + 11*z^41 + 4*z^40 - 6*z^39 + 2*z^37 - 15*z^36 + 3*z^35 + 13*z^34 + 7*z^33 - 14*z^32 - 9*z^31 - z^30 - 4*z^29 + 8*z^28 + 9*z^27 - z^26 - 6*z^25 + 19*z^24 + 14*z^23 - 15*z^22 + 4*z^21 + 4*z^20 - 5*z^19 + 4*z^18 + 14*z^17 + 8*z^16 + z^15 - 3*z^14 - 12*z^13 + 3*z^12 + 3*z^11 + 12*z^10 + 7*z^9 + 4*z^8 + 11*z^7 - z^6 - 10*z^5 + 7*z^4 - z^3 - 16*z^2 + 3*z + 13)&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># ==========================================</span><br><span class="hljs-comment"># 3. 解密</span><br><span class="hljs-comment"># ==========================================</span><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># 生成解密密钥</span><br>    key = sha256(sk_str.encode()).digest()<br>    <br>    <span class="hljs-comment"># 转换 hex 为 bytes</span><br>    iv = <span class="hljs-built_in">bytes</span>.fromhex(iv_hex)<br>    enc = <span class="hljs-built_in">bytes</span>.fromhex(enc_hex)<br>    <br>    <span class="hljs-comment"># AES 解密</span><br>    cipher = AES.new(key=key, mode=AES.MODE_CBC, iv=iv)<br>    plaintext = cipher.decrypt(enc)<br>    <br>    <span class="hljs-comment"># 去除填充并打印 Flag</span><br>    flag = unpad(plaintext, <span class="hljs-number">16</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[SUCCESS] Flag found:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(flag.decode())<br>    <br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[ERROR] Decryption failed: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>运行后得到结果：</p><img src="/2026/02/27/0xFunCTF2026wp/9.png" class=""><h3 id="the-fortune-teller">The Fortune Teller</h3><p>Gemini 得了 MVP ，我就是躺赢狗（）。</p><p>与 <strong>The Slot Whisperer</strong>类似，但因为数字很大，我们不能使用爆破了。因为泄露了高32位，同时给出了三个已知输出，很显然我们会思考去构造一个格出来，然后用<strong>格基规约</strong>求解。</p><p>具体代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># SageMath 脚本</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>():<br>    <span class="hljs-comment"># 1. 定义常数</span><br>    M = <span class="hljs-number">2</span>^<span class="hljs-number">64</span><br>    A = <span class="hljs-number">2862933555777941757</span><br>    C = <span class="hljs-number">3037000493</span><br>    <br>    <span class="hljs-comment"># 题目给出的观测值 (高32位)</span><br>    glimpses = [<span class="hljs-number">1332353447</span>, <span class="hljs-number">4117841481</span>, <span class="hljs-number">4217378265</span>]<br>    <br>    <span class="hljs-comment"># 2. 准备构建格所需的参数</span><br>    <span class="hljs-comment"># 计算 K_i (Bias)</span><br>    <span class="hljs-comment"># 关系推导: x_i = A^i * x_0 + K_i (mod M)</span><br>    <span class="hljs-comment"># K_i = (A^i * y0_full + Cumulative_C_i - yi_full) % M</span><br>    <br>    K = []<br>    <br>    <span class="hljs-comment"># 计算 A^i 和 累积 C</span><br>    <span class="hljs-comment"># S_i = A^i * S_0 + term_c</span><br>    <span class="hljs-comment"># term_c[0] = 0</span><br>    <span class="hljs-comment"># term_c[1] = C</span><br>    <span class="hljs-comment"># term_c[2] = A*C + C</span><br>    <br>    term_c = [<span class="hljs-number">0</span>, C, (A*C + C) % M]<br>    term_a = [<span class="hljs-number">1</span>, A, (A^<span class="hljs-number">2</span>) % M]<br>    <br>    base_shift = <span class="hljs-number">2</span>^<span class="hljs-number">32</span><br>    y0_full = glimpses[<span class="hljs-number">0</span>] * base_shift<br>    <br>    <span class="hljs-comment"># 计算 K1, K2 (对应 glimpse[1], glimpse[2])</span><br>    <span class="hljs-comment"># 注意：对于 i=0, x0 = 1*x0 + 0, 所以 K0=0，我们在矩阵中不需要 K0，只处理 K1, K2</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>):<br>        yi_full = glimpses[i] * base_shift<br>        <span class="hljs-comment"># K_i = A^i * (y0_full) + term_c[i] - yi_full</span><br>        val = (term_a[i] * y0_full + term_c[i] - yi_full) % M<br>        K.append(val)<br>        <br>    <span class="hljs-comment"># 3. 构建矩阵</span><br>    <span class="hljs-comment"># 目标寻找短向量: (x0, x1, x2, 1)</span><br>    <span class="hljs-comment"># Matrix B (4x4):</span><br>    <span class="hljs-comment"># [ 1,    A,    A^2,  0 ]</span><br>    <span class="hljs-comment"># [ 0,    M,    0,    0 ]</span><br>    <span class="hljs-comment"># [ 0,    0,    M,    0 ]</span><br>    <span class="hljs-comment"># [ 0,    K1,   K2,   1 ]</span><br>    <br>    B = Matrix(ZZ, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>)<br>    B[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br>    B[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>] = term_a[<span class="hljs-number">1</span>]<br>    B[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>] = term_a[<span class="hljs-number">2</span>]<br>    B[<span class="hljs-number">0</span>, <span class="hljs-number">3</span>] = <span class="hljs-number">0</span><br>    <br>    B[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] = M<br>    B[<span class="hljs-number">2</span>, <span class="hljs-number">2</span>] = M<br>    <br>    B[<span class="hljs-number">3</span>, <span class="hljs-number">1</span>] = K[<span class="hljs-number">0</span>] <span class="hljs-comment"># K1</span><br>    B[<span class="hljs-number">3</span>, <span class="hljs-number">2</span>] = K[<span class="hljs-number">1</span>] <span class="hljs-comment"># K2</span><br>    B[<span class="hljs-number">3</span>, <span class="hljs-number">3</span>] = <span class="hljs-number">1</span>    <span class="hljs-comment"># Constant constrol</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Executing LLL reduction...&quot;</span>)<br>    L = B.LLL()<br>    <br>    <span class="hljs-comment"># 4. 从规约后的基中提取解</span><br>    real_x0 = <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> L:<br>        <span class="hljs-comment"># LLL 可能产生正负号翻转的向量，检查最后一维是 1 或 -1</span><br>        vec = <span class="hljs-built_in">list</span>(row)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(vec[<span class="hljs-number">3</span>]) == <span class="hljs-number">1</span>:<br>            potential_x0 = vec[<span class="hljs-number">0</span>] * vec[<span class="hljs-number">3</span>] <span class="hljs-comment"># 修正符号</span><br>            <br>            <span class="hljs-comment"># 验证 x0 范围</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= potential_x0 &lt; <span class="hljs-number">2</span>^<span class="hljs-number">32</span>:<br>                <span class="hljs-comment"># 进一步验证是否符合 glimpse 序列</span><br>                s0 = y0_full + potential_x0<br>                <br>                <span class="hljs-comment"># 模拟推导</span><br>                curr = s0<br>                valid = <span class="hljs-literal">True</span><br>                <span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> glimpses:<br>                    <span class="hljs-keyword">if</span> (curr &gt;&gt; <span class="hljs-number">32</span>) != g:<br>                        valid = <span class="hljs-literal">False</span><br>                        <span class="hljs-keyword">break</span><br>                    curr = (curr * A + C) % M<br>                <br>                <span class="hljs-keyword">if</span> valid:<br>                    real_x0 = potential_x0<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n[+] Found x0: <span class="hljs-subst">&#123;real_x0&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] Recovered Initial State S0: <span class="hljs-subst">&#123;s0&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">break</span><br>    <br>    <span class="hljs-keyword">if</span> real_x0 <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># 5. 预测后5个状态</span><br>        <span class="hljs-comment"># 当前我们验证完 glimpses 后，curr 已经是 S3 (即第3个输出之后的下一个状态)</span><br>        <span class="hljs-comment"># 题目要求预测接下来 5 个</span><br>        <br>        state = (y0_full + real_x0)<br>        <br>        <span class="hljs-comment"># 先空转前3次 (对应已知的3个输出)</span><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>            state = (state * A + C) % M<br>            <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[+] Next 5 full 64-bit states:&quot;</span>)<br>        results = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;State <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>: <span class="hljs-subst">&#123;state&#125;</span>&quot;</span>)<br>            results.append(<span class="hljs-built_in">str</span>(state))<br>            state = (state * A + C) % M<br>            <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nFinal Answer String:&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span>.join(results))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] LLL failed.&quot;</span>)<br><br>solve()<br></code></pre></td></tr></table></figure><p>运行后得到结果：</p><img src="/2026/02/27/0xFunCTF2026wp/7.png" class=""><p>远程提交后即可得到 flag ：</p><img src="/2026/02/27/0xFunCTF2026wp/8.png" class=""><p>详细的题目文件与解题脚本以及 <strong>WriteUp</strong> 的 pdf可以通过关于页中我的 GitHub 仓库找到。</p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
